<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LawFlake - Relatórios</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/lawflake.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .chart-container {
            position: relative;
            height: 350px;
            margin: var(--spacing-lg) 0;
        }
        .filter-bar {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }
        .filter-bar select, .filter-bar input {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            font-family: var(--font-family);
            font-size: 0.95rem;
            transition: var(--transition);
        }
        .filter-bar select:focus, .filter-bar input:focus {
            outline: none;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <i class="bi bi-snow2"></i>
            <h1>LawFlake</h1>
        </div>

        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-link">
                <i class="bi bi-grid-fill"></i>
                Dashboard
            </a>
            <a href="processos.html" class="nav-link">
                <i class="bi bi-folder-fill"></i>
                Processos
            </a>
            <a href="chat.html" class="nav-link">
                <i class="bi bi-chat-dots-fill"></i>
                Chat IA
            </a>
            <a href="documentos.html" class="nav-link">
                <i class="bi bi-file-earmark-text-fill"></i>
                Documentos
            </a>
            <a href="relatorios.html" class="nav-link active">
                <i class="bi bi-graph-up"></i>
                Relatórios
            </a>
        </nav>

        <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid var(--gray-light);">
            <a href="perfil.html" class="nav-link">
                <i class="bi bi-person-circle"></i>
                Perfil
            </a>
            <a href="#" class="nav-link" onclick="logout()">
                <i class="bi bi-box-arrow-right"></i>
                Sair
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="page-header">
            <div>
                <h1 class="page-title">Relatórios</h1>
                <p class="page-subtitle">Análises e insights sobre seu portfólio legal</p>
            </div>
            <div class="page-actions">
                <button class="btn btn-outline" onclick="window.print()">
                    <i class="bi bi-printer"></i>
                    Imprimir
                </button>
                <button class="btn btn-primary" onclick="exportarRelatorio()">
                    <i class="bi bi-file-earmark-pdf"></i>
                    Exportar PDF
                </button>
            </div>
        </div>

        <!-- Filters -->
        <div class="card mb-4 fade-in">
            <div class="filter-bar">
                <select id="tipoRelatorio" onchange="atualizarRelatorio()">
                    <option value="executivo">Relatório Executivo</option>
                    <option value="detalhado">Relatório Detalhado</option>
                    <option value="prazos">Relatório de Prazos</option>
                </select>
                <input type="date" id="dataInicio" onchange="atualizarRelatorio()">
                <input type="date" id="dataFim" onchange="atualizarRelatorio()">
                <button class="btn btn-primary" onclick="atualizarRelatorio()">
                    <i class="bi bi-arrow-clockwise"></i>
                    Atualizar
                </button>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-2 mb-4">
            <!-- Chart 1: Processos ao Longo do Tempo -->
            <div class="card fade-in" style="animation-delay: 0.1s;">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="bi bi-graph-up"></i>
                        Processos ao Longo do Tempo
                    </h2>
                </div>
                <div class="chart-container">
                    <canvas id="processosChart"></canvas>
                </div>
            </div>

            <!-- Chart 2: Distribuição por Tribunal -->
            <div class="card fade-in" style="animation-delay: 0.2s;">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="bi bi-pie-chart"></i>
                        Distribuição por Tribunal
                    </h2>
                </div>
                <div class="chart-container">
                    <canvas id="tribunalChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Chart 3: Status dos Processos -->
        <div class="card mb-4 fade-in" style="animation-delay: 0.3s;">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="bi bi-bar-chart"></i>
                    Status dos Processos por Categoria
                </h2>
            </div>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="card fade-in" style="animation-delay: 0.4s;">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="bi bi-stars"></i>
                    Insights Gerados por IA
                </h2>
            </div>
            <div id="aiInsights">
                <div style="padding: var(--spacing-lg); background: var(--gray-lighter); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                    <h3 style="color: var(--primary); margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i class="bi bi-lightbulb"></i>
                        Tendências Identificadas
                    </h3>
                    <p style="color: var(--dark); margin: 0;">
                        Aumento de 15% nos processos trabalhistas nos últimos 3 meses. Recomenda-se revisar políticas de compliance.
                    </p>
                </div>
                <div style="padding: var(--spacing-lg); background: var(--gray-lighter); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                    <h3 style="color: var(--warning); margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i class="bi bi-exclamation-triangle"></i>
                        Riscos Identificados
                    </h3>
                    <p style="color: var(--dark); margin: 0;">
                        5 processos com prazos críticos nos próximos 7 dias. Atenção especial necessária para processo 1004555-07.2021.
                    </p>
                </div>
                <div style="padding: var(--spacing-lg); background: var(--gray-lighter); border-radius: var(--radius-sm);">
                    <h3 style="color: var(--success); margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i class="bi bi-check-circle"></i>
                        Oportunidades
                    </h3>
                    <p style="color: var(--dark); margin: 0;">
                        3 processos apresentam precedentes favoráveis recentes (2024) que podem fortalecer a argumentação jurídica.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script>
        let charts = {};

        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initializeDates();
            createCharts();
        });

        function initializeDates() {
            const hoje = new Date();
            const trintaDiasAtras = new Date(hoje.getTime() - (30 * 24 * 60 * 60 * 1000));

            document.getElementById('dataFim').valueAsDate = hoje;
            document.getElementById('dataInicio').valueAsDate = trintaDiasAtras;
        }

        function createCharts() {
            // Chart 1: Line Chart - Processos ao longo do tempo
            const ctx1 = document.getElementById('processosChart').getContext('2d');
            charts.processos = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Novos Processos',
                        data: [12, 19, 15, 25, 22, 30],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    }
                }
            });

            // Chart 2: Doughnut Chart - Tribunais
            const ctx2 = document.getElementById('tribunalChart').getContext('2d');
            charts.tribunal = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['TRT', 'TJSP', 'STJ', 'TST', 'Outros'],
                    datasets: [{
                        data: [30, 25, 20, 15, 10],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#10b981',
                            '#f59e0b',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Chart 3: Bar Chart - Status
            const ctx3 = document.getElementById('statusChart').getContext('2d');
            charts.status = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: ['Trabalhista', 'Cível', 'Tributário', 'Criminal', 'Outros'],
                    datasets: [
                        {
                            label: 'Ativo',
                            data: [45, 30, 25, 10, 15],
                            backgroundColor: '#10b981'
                        },
                        {
                            label: 'Concluído',
                            data: [20, 15, 10, 5, 8],
                            backgroundColor: '#667eea'
                        },
                        {
                            label: 'Suspenso',
                            data: [5, 3, 2, 1, 2],
                            backgroundColor: '#f59e0b'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        x: {
                            stacked: false
                        },
                        y: {
                            stacked: false,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        async function atualizarRelatorio() {
            const tipo = document.getElementById('tipoRelatorio').value;
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;

            console.log('Atualizando relatório:', { tipo, dataInicio, dataFim });

            // TODO: Call sp_exportar_relatorio
            alert(`Relatório será gerado usando:\n\nTipo: ${tipo}\nPeríodo: ${dataInicio} a ${dataFim}\n\nIntegração com sp_exportar_relatorio em desenvolvimento.`);
        }

        async function exportarRelatorio() {
            const tipo = document.getElementById('tipoRelatorio').value;

            alert(`Exportação de PDF em desenvolvimento.\n\nUsará sp_exportar_relatorio para gerar:\n- Relatório ${tipo}\n- Insights AI\n- Gráficos incluídos`);
        }
    </script>
</body>
</html>
